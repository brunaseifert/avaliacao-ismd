<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="author" content="Front-end desenvolvido por Bruna Seifert ©️ 2025" />
  <title>Avaliação de Atendimento - ISMD</title>
  <style>
    body {
      font-family: made-tommy Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
      background-color: #114739;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      padding: 20px;
    }

    .logo-bg {
      background-image: url('img/Logo horizontal branco.png'); 
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      width: 300px;
      height: 80px;
      margin-bottom: 20px;
    }

    .card {
      background-color: #ffffff;
      width: 90vw; 
      max-width: 600px;
      border-radius: 12px;
      padding: 30px;
    }

    h2 {
      color: #114739;
      font-size: 24px;
      margin-bottom: 15px;
      text-align: center;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
      font-size: 16px;
    }

  
    .anonimato-container label {
      font-weight: normal;
      position: relative;
      top: -4px; 
    }

    .id_Paciente {
      background-color: #f0f0f0;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
    }

    .carinhas {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-start; 
      margin-top: 10px;
      margin-bottom: 15px;
    }

    .carinhas input[type="radio"] {
      display: none;
    }

    .carinhas label {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icone-carinha {
      width: 60px;  
      height: 60px;
      transition: transform 0.2s ease;
      pointer-events: none;
    }

    input[type="radio"]:checked + label .icone-carinha {
      transform: scale(1.2);
    }

    .carinhas label:hover .icone-carinha {
      transform: scale(1.1);
    }

    .anonimato-container {
      margin-top: 10px;
      font-weight: normal;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }

    .anonimato-container input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
      margin: 0;
    }

    .buttons {
      display: flex;
      justify-content: flex-end; 
      margin-top: 20px;
    }

    button {
      padding: 12px 24px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

    .submit-btn {
      background-color: #114739;
      color: white;
    } 

    .riscado {
      text-decoration: line-through;
      color: gray;
    }

    .motivos-container {
      margin-top: 10px;
    }

    .motivos-opcoes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .motivo-balao {
      background-color: #e6f2ef;
      border: 1px solid #114739;
      color: #114739;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }

    .motivo-balao.selected {
      background-color: #114739;
      color: white;
    }
  </style>
</head>
<body>

<div class="logo-bg"></div>

<div class="card">
  <h2>Avaliação de Atendimento - ISMD</h2>

  <div class="id_Paciente">
    <p><strong>Data:</strong> <span id="data_span"></span></p>
    <p><strong>Hora:</strong> <span id="hora_span"></span></p>
    <p><strong>Atendente:</strong> <span id="atendente_nome_span"></span></p>
  </div>

  <form id="avaliacaoForm">
    <div class="criterion">
      <label class="criterion-title">Como foi seu atendimento?<span style="color: red;"> *</span></label>
      <div class="carinhas">
        <input type="radio" name="atendimento" id="atendimento_ruim" value="ruim" />
        <label for="atendimento_ruim" title="Ruim">
          <img src="img/Bravo.png" alt="Ruim" class="icone-carinha" />
        </label>

        <input type="radio" name="atendimento" id="atendimento_neutro" value="neutro" />
        <label for="atendimento_neutro" title="Neutro">
          <img src="img/neutro.png" alt="Neutro" class="icone-carinha" />
        </label>

        <input type="radio" name="atendimento" id="atendimento_bom" value="bom" />
        <label for="atendimento_bom" title="Bom">
          <img src="img/bom.png" alt="Bom" class="icone-carinha" />
        </label>

        <input type="radio" name="atendimento" id="atendimento_otimo" value="otimo" />
        <label for="atendimento_otimo" title="Ótimo">
          <img src="img/feliz.png" alt="Ótimo" class="icone-carinha" />
        </label>
      </div>
    </div>

    <div id="motivosContainer" class="motivos-container" style="display: none;">
      <label>O que motivou sua avaliação?</label>
      <div id="motivosOpcoes" class="motivos-opcoes"></div>
    </div>

    <div class="buttons">
      <button type="submit" class="submit-btn">Enviar</button>
    </div>
  </form>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const data = params.get("data") || "Não informado";
  const hora = params.get("hora") || "Não informado";
  const atendenteNome = params.get("atendente_nome") || "Não informado";

  document.getElementById("data_span").innerText = data;
  document.getElementById("hora_span").innerText = hora;
  document.getElementById("atendente_nome_span").innerText = atendenteNome;

  const motivosPorAvaliacao = {
    ruim: ["Demora no atendimento", "Falta de cordialidade", "Explicação confusa"],
    neutro: ["Atendimento regular", "Poderia melhorar", "Esperava mais"],
    bom: ["Bom atendimento", "Rapidez", "Clareza na explicação"],
    otimo: ["Excelente atendimento", "Muito atencioso", "Explicação clara e objetiva"]
  };

  const motivosContainer = document.getElementById("motivosContainer");
  const motivosOpcoes = document.getElementById("motivosOpcoes");

  const radios = document.querySelectorAll('input[name="atendimento"]');

  radios.forEach((radio) => {
    radio.addEventListener("change", () => {
      const valor = radio.value;
      const motivos = motivosPorAvaliacao[valor];

      motivosOpcoes.innerHTML = "";

      if (motivos && motivos.length > 0) {
        motivosContainer.style.display = "block";

        motivos.forEach((motivo) => {
          const span = document.createElement("span");
          span.className = "motivo-balao";
          span.innerText = motivo;

          span.addEventListener("click", () => {
            span.classList.toggle("selected");
          });

          motivosOpcoes.appendChild(span);
        });
      } else {
        motivosContainer.style.display = "none";
      }
    });
  });

document.getElementById("avaliacaoForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const atendimentoSelecionado = document.querySelector('input[name="atendimento"]:checked');

  if (!atendimentoSelecionado) {
    alert("Por favor, selecione uma opção em 'Como foi seu atendimento?'.");
    return;
  }

  const motivosSelecionados = Array.from(document.querySelectorAll(".motivo-balao.selected")).map(el => el.innerText);

  console.log("Motivos selecionados:", motivosSelecionados);

 // Seus dados a serem enviados
const dados = {
    data: data,
    hora: hora,
    atendente_nome: atendenteNome,
    atendimento: atendimentoSelecionado.value,
    motivos: motivosSelecionados.join(", "),
    params: Object.fromEntries(params.entries())
};

// Envia os dados para o arquivo PHP
fetch('arquivo.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(dados) 
})
.then(response => response.json())
.then(data => {
  
    console.log(data);
    if (data.status === 'success') {
        alert(data.message);
    } else {
        alert("Erro: " + data.message);
    }
})
.catch(error => {
    console.error('Erro na requisição:', error);
    alert('Ocorreu um erro ao conectar com o servidor.');
});

  window.location.href = "feedback.html";

});

</script>

</body>
</html>
